<html>
  <head> </head>
  <div class="center">
    <button id="dice">click</button>
    <button id="count">0</button>
    <button id="min">4</button>
    <button id="roll">Roll!</button>
  </div>

  <script>
    let idx = 0;
    let countIdx = 1;
    let minIdx = 0;
    const dices = ["d4", "d6", "d8", "d10", "d12", "d20"];
    const diceResults = {
      d4: ["-", 6, 7, 8, 9],
      d6: ["-", 1, 2, 3, 4, 5, 6],
      d8: ["-", 1, 2, 3, 4, 5, 6, 7, 8],
      d10: ["-", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
      d12: ["-", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
      d20: [
        "-",
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20
      ]
    };

    const diceButton = document.querySelector("#dice");
    const countButton = document.querySelector("#count");
    const minButton = document.querySelector("#min");
    const rollButton = document.querySelector("#roll");

    diceButton.textContent = dices[idx];
    countButton.textContent = countIdx;
    minButton.textContent = minIdx;

    diceButton.addEventListener("click", () => {
      minIdx = 0;
      idx = idx === dices.length - 1 ? 0 : idx + 1;
      diceButton.textContent = dices[idx];
      minButton.textContent = "-";
    });

    countButton.addEventListener("click", () => {
      countIdx = countIdx === 10 ? 1 : countIdx + 1;
      countButton.textContent = countIdx;
    });

    minButton.addEventListener("click", () => {
      const minLength = diceResults[dices[idx]].length;
      minIdx = minIdx === minLength - 1 ? 0 : minIdx + 1;
      minValue = diceResults[dices[idx]][minIdx];
      minButton.textContent = minValue;
    });

    document.querySelector("#roll").onclick = () => {
      const roll = {
        dice: dices[idx],
        count: countIdx,
        threshold: minIdx
      };
      parent.postMessage({ pluginMessage: roll }, "*");
    };
  </script>
</html>
